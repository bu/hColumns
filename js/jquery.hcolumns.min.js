// hColumns by bu <bu@hax4.in>, BSD License

(function(b){var k={nodeSource:function(){return window.alert("dummy source, you need to create a node source")},noContentString:"There is no node here",searchPlaceholderString:"Search...",searchable:!1,customNodeTypeIndicator:{},customNodeTypeHandler:{}},l={folder:function(a,c,d){a.nodeSource(d.id,function(c,d){return c?b.error(c):a.columnView._addColumnList(d,a.columnView)})},link:function(b,c,d){return window.open(d.url)}},m={folder:"icon-chevron-right",link:"icon-globe"},h={init:function(a){var c=
b.extend(k,a),d=b.extend(l,c.customNodeTypeHandler),e=b.extend(m,c.customNodeTypeIndicator);return this.each(function(){var a=b(this),g=a.data("columnView");h.settings=c;c.columnView=h;c.handlers=d;c.indicators=e;c.container_node=this;g||(a.data("hColumn",c),a.addClass("column-view-container"),b("<div></div>").addClass("column-view-composition").appendTo(a),a.on("click",".column ul li:not('.search')",c.columnView._entryClick),c.nodeSource(null,function(a,d){return a?b.error(a):c.columnView._addColumnList(d)}))})},
_entryClick:function(){var a=b(this).parents(".column-view-container").data("hColumn"),c=b(this).parents(".column-view-container"),d=b(this).parents(".column"),e=b(this).parents(".column").index(),f=b(this).data("node-type"),g=b(this).data("node-data");b(c).find(".column-view-composition .column:gt("+e+")").remove();d.find(".active").removeClass("active");b(this).addClass("active");return a.handlers[f](a,this,g)},_addColumnList:function(a,c){var d=c?c:this,e=b("<ul></ul>");if(0===a.length)return e=
b("<p></p>").text(c.settings.noContentString),d._addColumn(e,d);d.settings.searchable&&d._addColumnSearch(e);for(var f=0;f<a.length;f++){var g=b(document.createElement("li")).data("node-id",a[f].id).data("node-type",a[f].type).data("node-data",a[f]).attr("title",a[f].label),h=b(document.createElement("i")).addClass(d.settings.indicators[a[f].type]);g[0].appendChild(document.createTextNode(a[f].label));g[0].appendChild(h[0]);e[0].appendChild(g[0])}return d._addColumn(e,d)},_addColumnSearch:function(a){b('<li class="search"><input type="text" placeholder=" '+
this.settings.searchPlaceholderString+'"></li>').on("keyup","input",function(a){var d=b(this).val();2<=d.length?b(this).closest("li").siblings().each(function(){""!==d&&-1===b(this).data("node-data").label.toLowerCase().indexOf(d.toLowerCase())?b(this).hide():b(this).show()}):b(this).closest("li").siblings().show()}).appendTo(a)},_addColumn:function(a,c){var d=c?c:this,e=b("<div></div>").addClass("column");e.append(a);b(c.settings.container_node).find(".column-view-composition").append(e);b(c.settings.container_node).scrollLeft(b(".column-view-composition").width());
d.settings.searchable&&e.find("input").focus()}};b.fn.hColumns=function(a){if(h[a])return h[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)b.error("Method "+a+" does not exist on jQuery.hColumns");else return h.init.apply(this,arguments)}})(jQuery);
